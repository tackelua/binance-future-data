<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Binance Future Data - {{symbol}}</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f4f4f4;
    }

    h2 {
      color: #333;
    }

    pre {
      background: #282c34;
      color: #abb2bf;
      padding: 15px;
      border-radius: 8px;
      overflow-x: auto;
    }

    .copy-btn,
    .refresh-btn,
    .symbol-btn,
    .submit-btn,
    .update-btn {
      padding: 10px;
      border: none;
      cursor: pointer;
      border-radius: 5px;
      margin: 5px;
    }

    .copy-btn {
      background: #007bff;
      color: white;
    }

    .refresh-btn {
      background: #28a745;
      color: white;
    }

    .symbol-btn {
      background: #ffc107;
      color: black;
    }

    .submit-btn {
      background: #17a2b8;
      color: white;
    }

    .update-btn {
      background: #6c757d;
      color: white;
    }

    .symbol-input,
    .update-input {
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
      margin-right: 5px;
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
</head>

<body>
  <h2>Dá»¯ liá»‡u Binance cho cáº·p {{symbol}}</h2>
  <p>Thá»i gian cáº­p nháº­t: {{updateTime}}</p>
  <button class="copy-btn" onclick="copyPromptToClipboard()">ğŸ“‹ Copy Prompt</button>
  <button class="copy-btn" onclick="copyToClipboard()">ğŸ“‹ Copy JSON</button>
  <button class="copy-btn" onclick="copyFullToClipboard()">ğŸ“‹ Copy Full</button>
  <button class="refresh-btn" onclick="refreshData()">ğŸ”„ Refresh</button>
  <br />

  <!-- CÃ¡c cáº·p cÃ³ Ä‘Ã  tÄƒng máº¡nh (cÃ³ thá»ƒ tiáº¿p tá»¥c tÄƒng) -->
  <div style="margin: 10px 0;">
    <strong style="color: #28a745;">ğŸš€ ÄÃ  tÄƒng máº¡nh:</strong><br />
    {{strongMomentumButtons}}
  </div>

  <!-- CÃ¡c cáº·p cÃ³ tiá»m nÄƒng phá»¥c há»“i (quÃ¡ bÃ¡n) -->
  <div style="margin: 10px 0;">
    <strong style="color: #17a2b8;">ğŸ“ˆ Tiá»m nÄƒng phá»¥c há»“i:</strong><br />
    {{potentialBounceButtons}}
  </div>

  <!-- CÃ¡c cáº·p khá»‘i lÆ°á»£ng cao vÃ  Ä‘ang hoáº¡t Ä‘á»™ng -->
  <div style="margin: 10px 0;">
    <strong style="color: #ffc107;">ğŸ“Š Khá»‘i lÆ°á»£ng cao:</strong><br />
    {{highVolumeActiveButtons}}
  </div>
  <br />
  <form onsubmit="return changeSymbolFromInput()">
    <input type="text" id="symbolInput" class="symbol-input" placeholder="Nháº­p cáº·p symbol" list="symbolsSupportList" />
    <datalist id="symbolsSupportList"></datalist>
    <button type="submit" class="submit-btn">ğŸ” TÃ¬m kiáº¿m</button>
  </form>

  <p><i><span style="font-size: 0.9em;"><u>HÆ°á»›ng dáº«n:</u> Chá»n cáº·p symbol, báº¥m TÃ¬m kiáº¿m, rá»“i báº¥m nÃºt <b>Copy Full</b> vÃ 
        dÃ¡n vÃ o</span> <a href="https://gemini.google.com/" target="_blank" onclick="copyFullToClipboard()">Gemini</a> /
      <a href="https://grok.com/" target="_blank" onclick="copyFullToClipboard()">Grok</a> / <a href="https://poe.com/"
        target="_blank" onclick="copyFullToClipboard()">Poe</a></i></p>
  <p>Má»Ÿ nhanh Binance Futures: <a href="https://www.binance.com/en/futures/{{symbol}}"
      target="_blank">https://www.binance.com/en/futures/{{symbol}}</a></p>


  <pre><code class="language-json">{{formattedJson}}</code></pre>

  <!-- NhÃºng dá»¯ liá»‡u JSON an toÃ n, khÃ´ng gÃ¢y lá»—i cÃº phÃ¡p JS -->
  <script type="application/json" id="jsonData">{{minifiedJson}}</script>
  <script type="application/json" id="promptText">{{promptText}}</script>
  <script type="application/json" id="symbolsSupport">{{symbolsSupport}}</script>

  <script>
    // DEBUG: Kiá»ƒm tra script thá»±c thi
    console.log('Script loaded: debug start');

    // DEBUG: Kiá»ƒm tra ná»™i dung trÆ°á»›c khi parse
    function safeParse(id) {
      const el = document.getElementById(id);
      if (!el) {
        console.error('KhÃ´ng tÃ¬m tháº¥y tháº» script id=' + id);
        return null;
      }
      const txt = el.textContent;
      try {
        // Náº¿u lÃ  JSON há»£p lá»‡ thÃ¬ parse, náº¿u khÃ´ng thÃ¬ tráº£ vá» text
        const trimmed = txt.trim();
        if ((trimmed.startsWith('{') && trimmed.endsWith('}')) ||
          (trimmed.startsWith('[') && trimmed.endsWith(']'))) {
          return JSON.parse(txt);
        }
        return txt;
      } catch (e) {
        console.error('Lá»—i JSON.parse cho id=' + id + ':', e, '\nNá»™i dung:', txt);
        return null;
      }
    }
    const jsonData = safeParse('jsonData');
    const promptText = safeParse('promptText');
    const symbolsSupport = safeParse('symbolsSupport');

    async function copyToClipboard() {
      try {
        await navigator.clipboard.writeText(jsonData);
        showAlert(`âœ… ÄÃ£ copy JSON! Length: ${jsonData.length}`);
      } catch (err) {
        console.error("Lá»—i khi copy:", err);
      }
    }

    async function copyPromptToClipboard() {
      try {
        await navigator.clipboard.writeText(promptText);
        showAlert(`âœ… ÄÃ£ copy Prompt! Length: ${promptText.length}`);
      } catch (err) {
        console.error("Lá»—i khi copy Prompt:", err);
      }
    }

    async function copyFullToClipboard() {
      try {
        if (!navigator.clipboard || typeof navigator.clipboard.writeText !== 'function') {
          showAlert('âŒ TrÃ¬nh duyá»‡t khÃ´ng há»— trá»£ copy clipboard!');
          return;
        }
        // Copy Ä‘Ãºng object JSON: {prompt, 'binance_data'}
        console.log("\n\n\n\n========================");
        console.log(promptText)
        const fullPrompt = promptText + JSON.stringify(jsonData);
        await navigator.clipboard.writeText(fullPrompt);
        showAlert(`âœ… ÄÃ£ copy Full! Length: ${fullPrompt.length}`);
      } catch (err) {
        console.error("Lá»—i khi copy Full:", err);
        showAlert('âŒ Lá»—i khi copy Full!');
      }
    }

    function showAlert(message) {
      const alertBox = document.createElement("div");
      alertBox.textContent = message;
      alertBox.style.position = "fixed";
      alertBox.style.top = "20px";
      alertBox.style.right = "20px";
      alertBox.style.background = "#28a745";
      alertBox.style.color = "white";
      alertBox.style.padding = "10px 15px";
      alertBox.style.borderRadius = "5px";
      alertBox.style.boxShadow = "0 2px 10px rgba(0,0,0,0.2)";
      alertBox.style.fontSize = "14px";
      alertBox.style.zIndex = "1000";
      document.body.appendChild(alertBox);

      setTimeout(() => {
        alertBox.style.opacity = "0";
        alertBox.style.transition = "opacity 0.5s ease-out";
        setTimeout(() => document.body.removeChild(alertBox), 500);
      }, 5000);
    }

    function refreshData() {
      let url = new URL(window.location.href);
      if (url.searchParams.has("update")) {
        url.searchParams.delete("update");
        window.history.replaceState(null, "", url.toString());
      }
      location.reload();
    }

    function changeSymbol(symbol) {
      window.location.href = "/" + symbol;
    }

    function changeSymbolFromInput() {
      const symbolInput = document.getElementById("symbolInput").value;
      if (symbolInput) {
        window.location.href = "/" + symbolInput;
      }
      return false;
    }

    async function fetchsymbolsSupport() {
      try {
        const datalist = document.getElementById('symbolsSupportList');
        symbolsSupport.forEach(symbol => {
          const option = document.createElement('option');
          option.value = symbol;
          datalist.appendChild(option);
        });
      } catch (error) {
        console.error('Error fetching symbolsSupport:', error);
      }
    }

    window.onload = function () {
      Prism.highlightAll();
      fetchsymbolsSupport();
    }
  </script>
</body>

</html>