<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Binance Future Data - {{symbol}}</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f4f4f4;
    }

    h2 {
      color: #333;
    }

    pre {
      background: #282c34;
      color: #abb2bf;
      padding: 15px;
      border-radius: 8px;
      overflow-x: auto;
    }

    .copy-btn,
    .refresh-btn,
    .symbol-btn,
    .submit-btn,
    .update-btn {
      padding: 10px;
      border: none;
      cursor: pointer;
      border-radius: 5px;
      margin: 5px;
    }

    .copy-btn {
      background: #007bff;
      color: white;
    }

    .refresh-btn {
      background: #28a745;
      color: white;
    }

    .symbol-btn {
      background: #ffc107;
      color: black;
    }

    .submit-btn {
      background: #17a2b8;
      color: white;
    }

    .update-btn {
      background: #6c757d;
      color: white;
    }

    .symbol-input,
    .update-input {
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
      margin-right: 5px;
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
</head>

<body>
  <h2>D·ªØ li·ªáu Binance cho c·∫∑p {{symbol}}</h2>
  <p>Th·ªùi gian c·∫≠p nh·∫≠t: {{updateTime}}</p>
  <button class="copy-btn" onclick="copyPromptToClipboard()">üìã Copy Prompt</button>
  <button class="copy-btn" onclick="copyToClipboard()">üìã Copy JSON</button>
  <button class="copy-btn" onclick="copyFullToClipboard()">üìã Copy Full</button>
  <button class="refresh-btn" onclick="refreshData()">üîÑ Refresh</button>
  <br />
  <button class="symbol-btn" onclick="changeSymbol('SOLUSDT')">SOLUSDT</button>
  <button class="symbol-btn" onclick="changeSymbol('ADAUSDT')">ADAUSDT</button>
  <button class="symbol-btn" onclick="changeSymbol('BTCUSDT')">BTCUSDT</button>
  <button class="symbol-btn" onclick="changeSymbol('ETHUSDT')">ETHUSDT</button>
  <button class="symbol-btn" onclick="changeSymbol('XRPUSDT')">XRPUSDT</button>
  <br />
  <form onsubmit="return changeSymbolFromInput()">
    <input type="text" id="symbolInput" class="symbol-input" placeholder="Nh·∫≠p c·∫∑p symbol" list="symbolsSupportList" />
    <datalist id="symbolsSupportList"></datalist>
    <button type="submit" class="submit-btn">üîç T√¨m ki·∫øm</button>
  </form>

  <p><i><span style="font-size: 0.9em;"><u>H∆∞·ªõng d·∫´n:</u> Ch·ªçn c·∫∑p symbol, b·∫•m T√¨m ki·∫øm, r·ªìi b·∫•m n√∫t <b>Copy Full</b> v√† d√°n v√†o</span> <a href="https://gemini.google.com/" target="_blank" onclick="copyFullToClipboard()">Gemini</a> / <a href="https://grok.com/" target="_blank" onclick="copyFullToClipboard()">Grok</a></i></p>
  <p>M·ªü nhanh Binance Futures: <a href="https://www.binance.com/en/futures/{{symbol}}" target="_blank">https://www.binance.com/en/futures/{{symbol}}</a></p>


  <pre><code class="language-json">{{formattedJson}}</code></pre>

  <!-- Nh√∫ng d·ªØ li·ªáu JSON an to√†n, kh√¥ng g√¢y l·ªói c√∫ ph√°p JS -->
  <script type="application/json" id="jsonData">{{minifiedJson}}</script>
  <script type="application/json" id="promptText">{{promptText}}</script>
  <script type="application/json" id="symbolsSupport">{{symbolsSupport}}</script>

  <script>
    // DEBUG: Ki·ªÉm tra script th·ª±c thi
    console.log('Script loaded: debug start');

    // DEBUG: Ki·ªÉm tra n·ªôi dung tr∆∞·ªõc khi parse
    function safeParse(id) {
      const el = document.getElementById(id);
      if (!el) {
        console.error('Kh√¥ng t√¨m th·∫•y th·∫ª script id=' + id);
        return null;
      }
      const txt = el.textContent;
      try {
        return JSON.parse(txt);
      } catch (e) {
        console.error('L·ªói JSON.parse cho id=' + id + ':', e, '\nN·ªôi dung:', txt);
        return null;
      }
    }
    const jsonData = safeParse('jsonData');
    const promptText = safeParse('promptText');
    const symbolsSupport = safeParse('symbolsSupport');

    async function copyToClipboard() {
      try {
        await navigator.clipboard.writeText(jsonData);
        showAlert(`‚úÖ ƒê√£ copy JSON! Length: ${jsonData.length}`);
      } catch (err) {
        console.error("L·ªói khi copy:", err);
      }
    }

    async function copyPromptToClipboard() {
      try {
        await navigator.clipboard.writeText(promptText);
        showAlert(`‚úÖ ƒê√£ copy Prompt! Length: ${promptText.length}`);
      } catch (err) {
        console.error("L·ªói khi copy Prompt:", err);
      }
    }

    async function copyFullToClipboard() {
      try {
        if (!navigator.clipboard || typeof navigator.clipboard.writeText !== 'function') {
          showAlert('‚ùå Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ copy clipboard!');
          return;
        }
        // Copy ƒë√∫ng object JSON: {prompt, 'binance-data'}
        const fullObj = { prompt: promptText, 'binance-data': jsonData };
        const fullText = JSON.stringify(fullObj);
        await navigator.clipboard.writeText(fullText);
        showAlert(`‚úÖ ƒê√£ copy Full! Length: ${fullText.length}`);
      } catch (err) {
        console.error("L·ªói khi copy Full:", err);
        showAlert('‚ùå L·ªói khi copy Full!');
      }
    }

    function showAlert(message) {
      const alertBox = document.createElement("div");
      alertBox.textContent = message;
      alertBox.style.position = "fixed";
      alertBox.style.top = "20px";
      alertBox.style.right = "20px";
      alertBox.style.background = "#28a745";
      alertBox.style.color = "white";
      alertBox.style.padding = "10px 15px";
      alertBox.style.borderRadius = "5px";
      alertBox.style.boxShadow = "0 2px 10px rgba(0,0,0,0.2)";
      alertBox.style.fontSize = "14px";
      alertBox.style.zIndex = "1000";
      document.body.appendChild(alertBox);

      setTimeout(() => {
        alertBox.style.opacity = "0";
        alertBox.style.transition = "opacity 0.5s ease-out";
        setTimeout(() => document.body.removeChild(alertBox), 500);
      }, 5000);
    }

    function refreshData() {
      let url = new URL(window.location.href);
      if (url.searchParams.has("update")) {
        url.searchParams.delete("update");
        window.history.replaceState(null, "", url.toString());
      }
      location.reload();
    }

    function changeSymbol(symbol) {
      window.location.href = "/" + symbol;
    }

    function changeSymbolFromInput() {
      const symbolInput = document.getElementById("symbolInput").value;
      if (symbolInput) {
        window.location.href = "/" + symbolInput;
      }
      return false;
    }

    async function fetchsymbolsSupport() {
      try {
        const datalist = document.getElementById('symbolsSupportList');
        symbolsSupport.forEach(symbol => {
          const option = document.createElement('option');
          option.value = symbol;
          datalist.appendChild(option);
        });
      } catch (error) {
        console.error('Error fetching symbolsSupport:', error);
      }
    }

    window.onload = function () {
      Prism.highlightAll();
      fetchsymbolsSupport();
    }
  </script>
</body>

</html>