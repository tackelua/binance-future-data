<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Binance Future Data - {{symbol}}</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f4f4f4;
    }

    h2 {
      color: #333;
    }

    pre {
      background: #282c34;
      color: #abb2bf;
      padding: 15px;
      border-radius: 8px;
      overflow-x: auto;
    }

    .copy-btn,
    .refresh-btn,
    .symbol-btn,
    .submit-btn,
    .update-btn {
      padding: 10px;
      border: none;
      cursor: pointer;
      border-radius: 5px;
      margin: 5px;
    }

    .copy-btn {
      background: #007bff;
      color: white;
    }

    .refresh-btn {
      background: #28a745;
      color: white;
    }

    .symbol-btn {
      background: #ffc107;
      color: black;
    }

    .submit-btn {
      background: #17a2b8;
      color: white;
    }

    .update-btn {
      background: #6c757d;
      color: white;
    }

    .symbol-input,
    .update-input {
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
      margin-right: 5px;
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
</head>

<body>
  <h2>Dữ liệu Binance cho cặp {{symbol}}</h2>
  <p>Thời gian cập nhật: {{updateTime}}</p>
  <button class="copy-btn" onclick="copyPromptToClipboard()">📋 Copy Prompt</button>
  <button class="copy-btn" onclick="copyToClipboard()">📋 Copy JSON</button>
  <button class="copy-btn" onclick="copyFullToClipboard()">📋 Copy Full</button>
  <button class="refresh-btn" onclick="refreshData()">🔄 Refresh</button>
  <br />

  <!-- Các cặp có đà tăng mạnh (có thể tiếp tục tăng) -->
  <div style="margin: 10px 0;">
    <strong style="color: #28a745;">🚀 Đà tăng mạnh:</strong><br />
    {{strongMomentumButtons}}
  </div>

  <!-- Các cặp có tiềm năng phục hồi (quá bán) -->
  <div style="margin: 10px 0;">
    <strong style="color: #17a2b8;">📈 Tiềm năng phục hồi:</strong><br />
    {{potentialBounceButtons}}
  </div>

  <!-- Các cặp khối lượng cao và đang hoạt động -->
  <div style="margin: 10px 0;">
    <strong style="color: #ffc107;">📊 Khối lượng cao:</strong><br />
    {{highVolumeActiveButtons}}
  </div>
  <br />
  <form onsubmit="return changeSymbolFromInput()">
    <input type="text" id="symbolInput" class="symbol-input" placeholder="Nhập cặp symbol" list="symbolsSupportList" />
    <datalist id="symbolsSupportList"></datalist>
    <button type="submit" class="submit-btn">🔍 Tìm kiếm</button>
  </form>

  <p><i><span style="font-size: 0.9em;"><u>Hướng dẫn:</u> Chọn cặp symbol, bấm Tìm kiếm, rồi bấm nút <b>Copy Full</b> và
        dán vào</span> <a href="https://gemini.google.com/" target="_blank" onclick="copyFullToClipboard()">Gemini</a> /
      <a href="https://grok.com/" target="_blank" onclick="copyFullToClipboard()">Grok</a> / <a href="https://poe.com/"
        target="_blank" onclick="copyFullToClipboard()">Poe</a></i></p>
  <p>Mở nhanh Binance Futures: <a href="https://www.binance.com/en/futures/{{symbol}}"
      target="_blank">https://www.binance.com/en/futures/{{symbol}}</a></p>


  <pre><code class="language-json">{{formattedJson}}</code></pre>

  <!-- Nhúng dữ liệu JSON an toàn, không gây lỗi cú pháp JS -->
  <script type="application/json" id="jsonData">{{minifiedJson}}</script>
  <script type="application/json" id="promptText">{{promptText}}</script>
  <script type="application/json" id="symbolsSupport">{{symbolsSupport}}</script>

  <script>
    // DEBUG: Kiểm tra script thực thi
    console.log('Script loaded: debug start');

    // DEBUG: Kiểm tra nội dung trước khi parse
    function safeParse(id) {
      const el = document.getElementById(id);
      if (!el) {
        console.error('Không tìm thấy thẻ script id=' + id);
        return null;
      }
      const txt = el.textContent;
      try {
        // Nếu là JSON hợp lệ thì parse, nếu không thì trả về text
        const trimmed = txt.trim();
        if ((trimmed.startsWith('{') && trimmed.endsWith('}')) ||
          (trimmed.startsWith('[') && trimmed.endsWith(']'))) {
          return JSON.parse(txt);
        }
        return txt;
      } catch (e) {
        console.error('Lỗi JSON.parse cho id=' + id + ':', e, '\nNội dung:', txt);
        return null;
      }
    }
    const jsonData = safeParse('jsonData');
    const promptText = safeParse('promptText');
    const symbolsSupport = safeParse('symbolsSupport');

    async function copyToClipboard() {
      try {
        await navigator.clipboard.writeText(jsonData);
        showAlert(`✅ Đã copy JSON! Length: ${jsonData.length}`);
      } catch (err) {
        console.error("Lỗi khi copy:", err);
      }
    }

    async function copyPromptToClipboard() {
      try {
        await navigator.clipboard.writeText(promptText);
        showAlert(`✅ Đã copy Prompt! Length: ${promptText.length}`);
      } catch (err) {
        console.error("Lỗi khi copy Prompt:", err);
      }
    }

    async function copyFullToClipboard() {
      try {
        if (!navigator.clipboard || typeof navigator.clipboard.writeText !== 'function') {
          showAlert('❌ Trình duyệt không hỗ trợ copy clipboard!');
          return;
        }
        // Copy đúng object JSON: {prompt, 'binance_data'}
        console.log("\n\n\n\n========================");
        console.log(promptText)
        const fullPrompt = promptText + JSON.stringify(jsonData);
        await navigator.clipboard.writeText(fullPrompt);
        showAlert(`✅ Đã copy Full! Length: ${fullPrompt.length}`);
      } catch (err) {
        console.error("Lỗi khi copy Full:", err);
        showAlert('❌ Lỗi khi copy Full!');
      }
    }

    function showAlert(message) {
      const alertBox = document.createElement("div");
      alertBox.textContent = message;
      alertBox.style.position = "fixed";
      alertBox.style.top = "20px";
      alertBox.style.right = "20px";
      alertBox.style.background = "#28a745";
      alertBox.style.color = "white";
      alertBox.style.padding = "10px 15px";
      alertBox.style.borderRadius = "5px";
      alertBox.style.boxShadow = "0 2px 10px rgba(0,0,0,0.2)";
      alertBox.style.fontSize = "14px";
      alertBox.style.zIndex = "1000";
      document.body.appendChild(alertBox);

      setTimeout(() => {
        alertBox.style.opacity = "0";
        alertBox.style.transition = "opacity 0.5s ease-out";
        setTimeout(() => document.body.removeChild(alertBox), 500);
      }, 5000);
    }

    function refreshData() {
      let url = new URL(window.location.href);
      if (url.searchParams.has("update")) {
        url.searchParams.delete("update");
        window.history.replaceState(null, "", url.toString());
      }
      location.reload();
    }

    function changeSymbol(symbol) {
      window.location.href = "/" + symbol;
    }

    function changeSymbolFromInput() {
      const symbolInput = document.getElementById("symbolInput").value;
      if (symbolInput) {
        window.location.href = "/" + symbolInput;
      }
      return false;
    }

    async function fetchsymbolsSupport() {
      try {
        const datalist = document.getElementById('symbolsSupportList');
        symbolsSupport.forEach(symbol => {
          const option = document.createElement('option');
          option.value = symbol;
          datalist.appendChild(option);
        });
      } catch (error) {
        console.error('Error fetching symbolsSupport:', error);
      }
    }

    window.onload = function () {
      Prism.highlightAll();
      fetchsymbolsSupport();
    }
  </script>
</body>

</html>